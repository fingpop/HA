# inSona 网关集成组件

此组件允许您将 inSona 网关及其连接的设备集成到 HomeAssistant 中。

## 特性

- 支持灯光设备（开关灯、调光灯、色温灯、RGB灯、双模式灯）
- 支持窗帘设备
- 支持多房间设备管理
- 实时状态反馈

## 安装

1. 将 `custom_components/insona` 目录复制到您的 HomeAssistant 配置目录下的 `custom_components` 文件夹中
2. 重启 HomeAssistant
3. 在集成页面添加 inSona 网关

## 更新日志

### v0.1.0 (2025-03-26)
- 初始版本
- 实现基本的网关连接功能
- 支持发现和控制灯光设备
- 支持发现和控制窗帘设备

### v0.2.0 (2025-03-26)
- 修复了多个协程同时读取网关响应导致的错误
- 实现了基于队列的网关通信机制
- 添加了断开连接和重连逻辑

### v0.3.0 (2025-03-26)
- 修复了色温转换逻辑，正确映射 inSona 色温值(0-100)到 HomeAssistant 色温值(2700K-6500K)
- 添加了双模式灯具支持（同时支持色温和RGB）
- 实现了根据设备功能自动识别灯具类型

### v0.4.0 (2025-03-26)
- 修改了控制命令格式，不再包含开关状态
- 优化了状态反馈处理逻辑
- 修复了窗帘状态反馈处理

### v0.5.0 (2025-03-26)
- 修复了RGB灯具状态反馈错误
- 实现了双模式灯具在收到不同func状态时自动切换模式
- 修复了列表索引越界错误

### v0.6.0 (2025-03-27)
- 修正了色温转换逻辑，现在正确映射:
  - inSona: 0 -> 2700K (最暖)，100 -> 6500K (最冷)
  - HomeAssistant: 2700K (最暖) -> 6500K (最冷)
- 优化了双模式灯具的模式切换处理

## 协议支持

### 设备类型
- `1984`: 灯具设备
- `1860`: 窗帘设备
- `1218`: 面板设备
- `1344`: 传感器设备

### 功能类型
- `2`: 开关功能
- `3`: 亮度功能
- `4`: 亮度色温功能
- `5`: HSL(RGB)功能

### 状态反馈
组件能够接收并处理 s.event 状态反馈，更新设备状态：
- func=2: 开关控制反馈
- func=3: 亮度控制反馈
- func=4: 亮度色温控制反馈
- func=5: HSL控制反馈

### 双模式灯具
对于同时支持色温(func=4)和RGB(func=5)功能的灯具，组件会根据当前控制方式自动切换UI模式。

## 已知问题
- 部分传感器设备可能无法正确识别
- 快速连续控制可能导致状态不同步

## 配置选项
- 主机地址：inSona网关的IP地址
- 端口：inSona网关的端口号（默认8091）

## 致谢
感谢 HomeAssistant 社区和 inSona 协议文档提供的支持。 